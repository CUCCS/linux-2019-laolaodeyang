# 《Linux系统与网络管理》实验一
### 软件环境
+ Virtualbox
+ Ubuntu 18.04 Server 64bit
  - 备选：Ubuntu 16.04 Server 64bit
  - 备选：Ubuntu 16.04 Desktop 64bit
### 实验内容
+ 如何配置无人值守安装iso并在Virtualbox中完成自动化安装？
+ Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？
+ 如何使用sftp在虚拟机和宿主机之间传输文件？
### 实验过程
#### 一、Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？
1. 首先成功安装ubuntu
+ 建立自己的用户名密码
![用户名密码](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81.png "用户名密码")
+ 遇到一个问题：每次重新启动都要重新安装一遍ubuntu，发现ubuntu的启动顺序可以更换，更改至硬盘优先即可。
![修改前顺序](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F.png "修改前顺序")
![修改后顺序](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E6%9B%B4%E6%94%B9%E5%90%8E%E7%9A%84%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F.png "修改后顺序")
2. 为虚拟机添加一块新的```host-only```模式的网卡
![新建网卡](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E6%96%B0%E5%BB%BAhost-only%E7%BD%91%E5%8D%A1.png "新建网卡")
+ 在主机网络管理器中开启DHCP服务器
![开启dhcp](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E7%BD%91%E5%8D%A1dhcp%E5%BC%80%E5%90%AF.png "开启dhcp")
![开启dhcp](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86.png "开启dhcp")
+ 用ifconfig查看现有网卡、ip地址等
![无新网卡信息](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E6%97%A0%E6%96%B0%E7%BD%91%E5%8D%A1%E7%9A%84%E4%BF%A1%E6%81%AF.png "无新网卡信息")
+ 使用```sudo ifconfig enp0s8 up```更新信息，新增加的网卡并未分配地址
![无新网卡地址](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E6%96%B0%E7%BD%91%E5%8D%A1%E6%97%A0%E5%9C%B0%E5%9D%80.png "无新网卡地址")
+ ```sudo dhclient enp0s8``` 即实现为新网卡自动分配地址 ```192.168.56.102```
![新网卡地址](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E6%96%B0%E7%BD%91%E5%8D%A1%E5%88%86%E9%85%8D%E5%90%8E%E5%9C%B0%E5%9D%80.png "新网卡地址")
#### 二、如何使用sftp在虚拟机和宿主机之间传输文件？
1. 安装系统时已选择安装```OpenSSH server```
![已安装ssh](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E5%AE%89%E8%A3%85ssh.png "已安装ssh")
2. 或者再使用```sudo apt install openssh-server```进行下载
![确认已安装ssh](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E7%A1%AE%E8%AE%A4%E4%B8%8B%E8%BD%BDssh.png "确认已安装ssh")
3. 使用```sudo /etc/init.d/ssh start```来开启ssh服务
![开启ssh](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E5%BC%80%E5%90%AFssh.png "开启ssh")
4. 确认虚拟机端口开启```netstat -a|grep ssh```
![ssh端口开启](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/%E7%A1%AE%E8%AE%A4%E7%AB%AF%E5%8F%A3%E5%BC%80%E5%90%AF.png "ssh端口开启")
5. putty连接
![putty连接](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/实验一——无人值守/putty连接.png "putty连接")
![putty安全](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/putty%E5%AE%89%E5%85%A8.png "putty安全")
6. 连接本地```sftp ytq@ytq```，输入密码，连接成功
![sftp连接](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/sftp%E8%BF%9E%E6%8E%A5.png "sftp连接")
![sftp帮助](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/sftp%E5%B8%AE%E5%8A%A9.png "sftp帮助")
7. 使用put语句、get语句等进行虚拟机和宿主机之间的文件传输
![sftp传输](https://github.com/CUCCS/linux-2019-laolaodeyang/blob/%E5%AE%9E%E9%AA%8C%E4%B8%80%E2%80%94%E2%80%94%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88/sftp%E4%BC%A0%E8%BE%93.png "sftp传输")
#### 三、如何配置无人值守安装iso并在Virtualbox中完成自动化安装？
1. 在当前用户目录下创建一个用于挂载iso镜像文件的目录
```mkdir loopdir```
2. 挂载iso镜像文件到该目录
```mount -o loop ubuntu-18.04.1-server-amd64.iso loopdir```
3. 创建一个工作目录用于克隆光盘内容
```mkdir cd```
4. 同步光盘内容到目标工作目录
```rsync -av loopdir/cd```
5. 卸载iso镜像
```umount loopdir```
6. 进入目标工作目录，编辑ubuntu安装引导界面增加一个新菜单项入口
```vim isolinux/txt.cfg```
7. 将以下内容添加到txt.cfg中然后强制保存退出
```
label autoinstall
   menu label ^Auto Install Ubuntu Server
   kernel /install/vmlinuz
   append  file=/cdrom/preseed/ubuntu-server-autoinstall.seed debian-installer/locale=en_US console-setup/layoutcode=us keyboard-configuration/layoutcode=us console-setup/ask_detectfalse localechooser/translation/warn-light=true localechoosertranslation/warn-severe=true initrd=/install/initrd.gz root=/dev/ram rw quiet
```
8. 阅读并编辑定制ubuntu官方提供的示例preseed.cfg,并将改文件保存到刚才创建的工作目录
9. 重新生成md5sum.txt
```cd ~/cd&&find. -type f -print0|xargs -0 md5sum >md5sum.txt```
10. 封闭改动后的目录到iso
```
IMAGE=custom.iso
BUILD=~/cd/

mkisofs -r -V "Custom Ubuntu InstallCD"\
             -cache-inodes\
             -J -l -b isolinux/isolinux.bin\
             -c isolinux/boot.cat -no-emul-boot\
             -boot-load-size 4 -boot-info-table\
             -o $IMAGE $BUILD
```

10.最后使用psftp将修改好的镜像从虚拟机下载到宿主机
```get /home/ytq/cd/custom.iso```
#### 对比老师修改好的ubuntu-server-autoinstall.seed与官方示例文件
