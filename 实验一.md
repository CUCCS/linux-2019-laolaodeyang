# 《Linux系统与网络管理》实验一
### 软件环境
+ Virtualbox
+ Ubuntu 18.04 Server 64bit
  - 备选：Ubuntu 16.04 Server 64bit
  - 备选：Ubuntu 16.04 Desktop 64bit
### 实验内容
+ 如何配置无人值守安装iso并在Virtualbox中完成自动化安装？
+ Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？
+ 如何使用sftp在虚拟机和宿主机之间传输文件？
### 实验过程
#### 一、Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？
1. 首先成功安装ubuntu
+ 建立自己的用户名密码
+ 遇到一个问题：每次重新启动都要重新安装一遍ubuntu，发现ubuntu的启动顺序可以更换，更改至硬盘优先即可。
2. 为虚拟机添加一块新的```host-only```模式的网卡
+ 在主机网络管理器中开启DHCP服务器
+ 用ifconfig查看现有网卡、ip地址等
+ 使用```sudo ifconfig enp0s8 up```更新信息，新增加的网卡并未分配地址
+ ```sudo dhclient enp0s8``` 即实现为新网卡自动分配地址 ```192.168.56.102```
#### 二、如何使用sftp在虚拟机和宿主机之间传输文件？
1. 安装系统时已选择安装```OpenSSH server```
2. 或者再使用```sudo apt install openssh-server```进行下载
3. 使用```sudo /etc/init.d/ssh start```来开启ssh服务
4. 确认虚拟机端口开启```netstat -a|grep ssh```
5. 连接本地```sftp ytq@ytq```，属于密码，连接成功
6. 使用put语句、get语句等进行虚拟机和宿主机之间的文件传输
#### 三、如何配置无人值守安装iso并在Virtualbox中完成自动化安装？
1. 在当前用户目录下创建一个用于挂载iso镜像文件的目录
```mkdir loopdir```
2. 挂载iso镜像文件到该目录
```mount -o loop ubuntu-18.04.1-server-amd64.iso loopdir```
3. 创建一个工作目录用于克隆光盘内容
```mkdir cd```
4. 同步光盘内容到目标工作目录
```rsync -av loopdir/cd```
5. 卸载iso镜像
```umount loopdir```
6. 进入目标工作目录，编辑ubuntu安装引导界面增加一个新菜单项入口
```vim isolinux/txt.cfg```
7. 将以下内容添加到txt.cfg中然后强制保存退出
```
label autoinstall
   menu label ^Auto Install Ubuntu Server
   kernel /install/vmlinuz
   append  file=/cdrom/preseed/ubuntu-server-autoinstall.seed debian-installer/locale=en_US console-setup/layoutcode=us keyboard-configuration/layoutcode=us console-setup/ask_detectfalse localechooser/translation/warn-light=true localechoosertranslation/warn-severe=true initrd=/install/initrd.gz root=/dev/ram rw quiet
```
8. 阅读并编辑定制ubuntu官方提供的示例preseed.cfg,并将改文件保存到刚才创建的工作目录
9. 重新生成md5sum.txt
```cd ~/cd&&find. -type f -print0|xargs -0 md5sum >md5sum.txt```
10. 封闭改动后的目录到iso
```
IMAGE=custom.iso
BUILD=~/cd/

mkisofs -r -V "Custom Ubuntu InstallCD"\
             -cache-inodes\
             -J -l -b isolinux/isolinux.bin\
             -c isolinux/boot.cat -no-emul-boot\
             -boot-load-size 4 -boot-info-table\
             -o $IMAGE $BUILD
```

10.最后使用psftp将修改好的镜像从虚拟机下载到宿主机
```get /home/ytq/cd/custom.iso```
#### 对比老师修改好的ubuntu-server-autoinstall.seed与官方示例文件
